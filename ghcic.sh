#!/bin/sh

# Color reset
rst=`echo "[0;48;05;16m"`

# Colors
light_blue="[38;05;123m"
error_red="[38;05;202m"
success_green="[38;05;82m"
yellow="[38;05;228m"
red="[38;05;210m"
orange="[38;05;223m"
cyan="[38;05;51m"
green="[38;05;46m"
purple="[38;05;201m"
grey="[38;05;240m"


# –º–∞—à–∏–Ω—É –¢—å—é—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–æ–º–∏ —Ç–∞–∫:
# –°–Ω–∞—á–∞–ª–∞ –≤—ã–¥–µ–ª—è–µ–º —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ —Ä–∞—Å–∫—Ä–∞—Å–∏—Ç—å - –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º —Å –Ω–∞—á–∞–ª–∞ –∏ —Å –∫–æ–Ω—Ü–∞ —Ç–µ–º, —á–µ–≥–æ –≤ —Å—Ç—Ä–æ–∫–µ —Ç–æ—á–Ω–æ –Ω–µ—Ç: —Å–∏–º–≤–æ–ª–æ–º –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏.
# —Ä–µ–≥—É–ª—è—Ä–∞, –≤ —Ü–µ–ª–æ–º, –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ç–∞–∫–∞—è:
# ^((—Ç–æ, —á—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º)|\n(—Ç–æ, —á—Ç–æ –∏—â–µ–º)\n)*(—Ç–æ, —á—Ç–æ –∏—â–µ–º)
# –∏—â–µ–º –æ—Ç –Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∫–∏, –Ω–∞–ø–∞—Ä—ã–≤–∞–µ–º—Å—è –Ω–∞ (—Ç–æ, —á—Ç–æ –∏—â–µ–º). –∏ –º–µ–Ω—è–µ–º –Ω–∞ \n(—Ç–æ, —á—Ç–æ –∏—â–µ–º)\n. –ò –∑–∞–Ω–æ–≤–æ –∏ –ø–æ–∫–∞ –Ω–µ –ø—Ä–æ–π–¥—ë–º—Å—è –≤–¥–æ–ª—å —Å—Ç—Ä–æ–∫–∏ –Ω–µ –Ω–∞–π–¥—è –Ω–∏—á–µ–≥–æ...

# –ó–∞—Ç–µ–º –ø–æ —Å—Ç—Ä–æ–∫–µ –∏—â–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã. –Ω–∞—Ö–æ–¥–∏–º - —Ä–∞—Å–∫—Ä–∞—à–∏–≤–∞–µ–º –∏ —É–±–∏—Ä–∞–µ–º —Ä–∞–∑—Ä—ã–≤—ã —Å—Ç—Ä–æ–∫.
#
# ':loop s/abc/def/; t loop' 
# t = —Ç–µ—Å—Ç. –µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –Ω–∞—á–∞–ª–æ. –µ—Å–ª–∏ –Ω–µ—Å—Ä–∞–±–æ—Ç–∞–ª–∞ - –≤—ã—Ö–æ–¥. 
lexemize=':loop s/^(("((\\.)|[^\\"])*"|\n_?[[:alnum:]]+[[:alnum:].]*\n|\n-?[[:digit:]]+([.][[:digit:]]+)?\n|\n[=*}{()[]\n|\n[]]\n|[, ]|\n['"'][[:alnum:]]['"']\n|\n::\n|\n->\n|\n=>\n)*)(_?[[:alnum:]]+[[:alnum:].]*|-?[[:digit:]]+([.][[:digit:]]+)?|['"'][[:alnum:]]['"']|=>|[=*}{()[]|[]]|::|->)/\1\n\6\n/; t loop'
	
# 's/   
# ^(
# (     "((\\.)|[^\\"])*"                    |   —Å—Ç—Ä–æ–∫–∏ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º. –∏—Ö —Ä–∞—Å–∫—Ä–∞—à–∏–≤–∞–µ–º –≤ –ø–æ—Å–ª–µ–¥–Ω—é—é –æ—á–µ—Ä–µ–¥—å.
#       \n_?[[:alnum:]]+[[:alnum:].]*\n      |    
#       \n-?[[:digit:]]+([.][[:digit:]]+)?\n |
#       \n[=*}{()[]\n                        |
#		\n[]]\n                              |
#		[, ]                                 |
#		\n['"'][[:alnum:]]['"']\n            |
#		\n::\n                               |
#		\n->\n                               |
#		\n=>\n)
#	*)
#	(_?[[:alnum:]]+[[:alnum:].]*|[[:digit:]]+([.][[:digit:]]+)?|['"'][[:alnum:]]['"']|=>|[=*}{()[]|[]]|::|->)/\1\n\6\n/	'


# –ö—Ä–∞—Å–Ω—ã–π: —á–∏—Å–ª–æ, –≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ.
#
#
#
cRed="s/\n(-?[[:digit:]]+([.][[:digit:]]+)?)\n/$red\1$rst/g;"

# –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–ª–∏ =
# —à–∞–±–ª–æ–Ω: –ò–ª–∏: —Å–Ω–∞—á–∞–ª–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –±—É–∫–≤–∞ (—Å–ª–æ–≤–æ, —Ñ—Ä–∞–∑–∞), –∑–∞—Ç–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤ "—Ü–∏—Ñ—Ä–æ–±—É–∫–≤–∞."
#         –∏–ª–∏: * –∏–ª–∏ =
cOrange="s/\n(_?[[:alnum:]]+[[:alnum:].]*|[*=])\n/$orange\1$rst/g;"

# –ó–µ–ª—ë–Ω—ã–π: –æ–¥–∏–Ω–æ—á–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –æ–¥–∏–Ω–∞—Ä–Ω—ã—Ö –∫–∞–≤—ã—á–∫–∞—Ö –∏ –∫—Ä—É–≥–ª—ã–µ —Å–∫–æ–±–∫–∏
# 'a'
# '3'
# ()
cGreen="s/\n(['][[:alnum:]][']|[)(])\n/$green\1$rst/g;"

# –ì–æ–ª—É–±–æ–π: 
# ::
# ->
# =>
# ]
# [
cCyan="s/\n([[]|[]]|::|->|=>)\n/$cyan\1$rst/g;"

# —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏ —Ä–∞—Å–∫—Ä–∞—à–∏–≤–∞–µ–º —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–º
cPurple="s/\n([}{])\n/$purple\1$rst/g;"

# —à–∞–±–ª–æ–Ω —Å—Ç—Ä–æ–∫–∏: 
# "
# –ª–∏–±–æ (\\.) - –±—ç–∫—Å–ª—ç—à —Å –ª—é–±—ã–º –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —Å–∏–º–≤–æ–ª–æ–º, –∫—Ä–æ–º–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
# –ª–∏–±–æ [^\\"] - –ª–∏–±–æ –Ω–µ –±—ç–∫—Å–ª—ç—à.
# –≤ –ª—é–±–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ
# "
cStrings='s/"((\\.)|[^\\"])*"/'"$yellow&$rst/g;"
loading="/^Loading package /{s/^.*$/$grey&$rst/;}"
failed_loading="/^Failed, modules loaded: none.$/{s/^.*$/$error_red&$rst/;}"
success_loading="/^Ok, modules loaded:/{s/^.*$/$success_green&$rst/;}"
interactive="/^<interactive>:/{s/^.*$/$error_red&$rst/;}"

# -r = —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ä–µ–≥–≤—ã—Ä—ã –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ
# sed 's/abc/def/g; s/xyz/uvw/g' = —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∑–∞—Ç–µ–º —Å–ª–µ–¥—É—é—â–∞—è.
exec "`which ghc`" --interactive ${1+"$@"} 2>&1 |\
sed -r "
$success_loading
$failed_loading
$loading
$interactive
$lexemize $cRed $cOrange $cGreen $cCyan $cPurple $cStrings"

